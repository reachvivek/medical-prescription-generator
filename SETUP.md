# Medical Prescription Generator - Setup Guide

## Architecture

This application uses a **client-server architecture** for PDF generation:

- **Frontend**: React + Vite (port 5173)
- **Backend**: Node.js + Express + Puppeteer (port 3001)

## Why Backend PDF Generation?

- ✅ **75% smaller bundle**: Reduced from 2MB to 511KB
- ✅ **Better performance**: PDF generation offloaded to server
- ✅ **More reliable**: Uses headless Chrome (Puppeteer) for consistent output
- ✅ **HTML/CSS templates**: Easier to customize and maintain

## Installation

```bash
npm install
```

This will install both frontend and backend dependencies.

## Running the Application

### Option 1: Run Both Servers Together (Recommended)

```bash
npm run dev:all
```

This starts:
- Frontend dev server on `http://localhost:5173`
- Backend PDF server on `http://localhost:3001`

### Option 2: Run Separately

**Terminal 1** - Backend:
```bash
npm run server
```

**Terminal 2** - Frontend:
```bash
npm run dev
```

## Testing PDF Generation

1. Open `http://localhost:5173` in your browser
2. Click "View Sample Prescription"
3. Click the "Download" button dropdown
4. Select "Download as PDF"
5. PDF will be generated by the backend and downloaded

## Backend API Endpoints

### Generate PDF
```
POST http://localhost:3001/api/generate-pdf
Content-Type: application/json

Body: { /* prescription data */ }

Response: PDF file (application/pdf)
```

### Health Check
```
GET http://localhost:3001/health

Response: { "status": "ok", "message": "PDF service is running" }
```

## Production Deployment

### Backend
Deploy the Node.js server (server.js) to:
- Railway
- Render
- Heroku
- AWS Lambda (with Puppeteer Layer)
- Any Node.js hosting

### Frontend
Deploy the built frontend (dist/) to:
- Vercel
- Netlify
- Cloudflare Pages

**Important**: Update the API URL in `src/components/layout/Hero.jsx`:
```javascript
// Change from:
const response = await fetch('http://localhost:3001/api/generate-pdf', {

// To:
const response = await fetch('https://your-backend-url.com/api/generate-pdf', {
```

Or better, use environment variables:
```javascript
const API_URL = import.meta.env.VITE_API_URL || 'http://localhost:3001';
const response = await fetch(`${API_URL}/api/generate-pdf`, {
```

## Troubleshooting

### "Failed to generate PDF" error
- Make sure the backend server is running on port 3001
- Check `npm run server` output for errors
- Verify `http://localhost:3001/health` returns OK

### Puppeteer issues
First run may be slow as Puppeteer downloads Chromium (~200MB). Subsequent runs will be fast.

If Puppeteer fails to install:
```bash
npm install puppeteer --ignore-scripts=false
```

### Port already in use
Change port in `server.js`:
```javascript
const PORT = 3002; // Change to any available port
```

Also update the fetch URL in Hero.jsx to match.

## Development

### Modify PDF Template
Edit the HTML template in `server.js` > `getPrescriptionHTML()` function.

### Styling
The PDF uses inline CSS in the template. All styles are in the `<style>` tag within the HTML template.

### Adding Dynamic Data
Pass data in the POST request body and use it in the template:
```javascript
app.post('/api/generate-pdf', async (req, res) => {
  const { doctorName, patientName, medications } = req.body;
  // Use these variables in your template
});
```

## Notes

- First Puppeteer run may take ~1min to download Chromium
- PDF generation takes ~2-3 seconds per prescription
- For high volume, consider using a PDF generation queue (Bull, BullMQ)
- For production, add rate limiting and authentication to the API
